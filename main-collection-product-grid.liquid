<!-------------------- Add below js in main-collection-product-grid.liquid ----------------------------->

<script>
 document.addEventListener('DOMContentLoaded', function() {
  let currentPage = 1;
  let isLoading = false;
  const productGrid = document.getElementById('product-grid');
  const productContainer = document.getElementById('ProductGridContainer');

  // Function to load more products
  function loadMoreProducts() {
    if (isLoading) return;
    isLoading = true;
    currentPage++;

    fetch(`${window.location.pathname}?page=${currentPage}`, {
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      }
    })
    .then(response => response.text())
    .then(data => {
      const parser = new DOMParser();
      const htmlDoc = parser.parseFromString(data, 'text/html');
      const newProducts = htmlDoc.querySelectorAll('#product-grid li');

      newProducts.forEach(function(product) {
        productGrid.appendChild(product);
      });

      isLoading = false;
    })
    .catch(error => {
      console.error('Error loading more products:', error);
      isLoading = false;
    });
  }

  // Adjust the scroll trigger
  window.addEventListener('scroll', function() {
    // Check if the user is 300px from the bottom of the product grid (instead of the entire page)
    const scrollPosition = window.innerHeight + window.pageYOffset;
    const productGridHeight = productGrid.offsetHeight + productGrid.offsetTop;

    if (scrollPosition >= productGridHeight - 300 && !isLoading) {
      loadMoreProducts();
    }
  });
});

</script>
